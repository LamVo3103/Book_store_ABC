<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Theo D√µi ƒê∆°n H√†ng - Nh√† S√°ch ABC</title>
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .all-orders-title {
        color: #1976d2;
        margin: 20px 0;
        padding-bottom: 10px;
        border-bottom: 2px solid #e3f2fd;
      }
    </style>
  </head>
  <body>
    <!-- HEADER (Gi·ªëng c√°c trang kh√°c) -->
    <header>
      <a href="index.html">
        <div class="logo">
          <h1>Nh√† S√°ch ABC</h1>
        </div>
      </a>

      <nav class="nav-menu">
        <ul>
          <li><a href="index.html" style="color: #fbbf24">Trang Ch·ªß</a></li>
          <li><a href="tatcasanpham.html">S·∫£n Ph·∫©m</a></li>
          <li><a href="#footer">Li√™n H·ªá</a></li>
          <li>
            <a href="cacdonhang.html"> ƒê∆°n h√†ng</a>
          </li>
          <li><a href="theodoidonhang.html">Theo d√µi ƒë∆°n h√†ng</a></li>
        </ul>
      </nav>

      <!-- B·ªè search-cart v√† user-actions v√†o 1 container chung -->
      <div class="header-right">
        <div class="search-cart">
          <input type="text" placeholder="T√¨m ki·∫øm s√°ch..." />
          <button>T√¨m</button>
          <a href="#" class="cart">üõí</a>
        </div>

        <div class="user-actions">
          <div class="auth-dropdown">
            <button class="auth-btn" id="userMenuBtn">
              <i class="fas fa-user"></i> T√†i kho·∫£n
            </button>
            <div class="auth-dropdown-content">
              <a href="account.html"><i class="fas fa-user"></i> T√†i kho·∫£n</a>
              <a href="giohang.html"
                ><i class="fas fa-shopping-cart"></i> Gi·ªè h√†ng</a
              >
              <a href="#" id="logoutLink"
                ><i class="fas fa-sign-out-alt"></i> ƒêƒÉng xu·∫•t</a
              >
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- N·ªôi dung theo d√µi ƒë∆°n h√†ng -->
    <div class="order-tracking-container">
      <h1 class="all-orders-title">
        <i class="fas fa-clipboard-list"></i> T·∫•t c·∫£ ƒë∆°n h√†ng c·ªßa b·∫°n
      </h1>

      <div id="orders-list">
        <!-- C√°c ƒë∆°n h√†ng s·∫Ω ƒë∆∞·ª£c th√™m v√†o ƒë√¢y b·∫±ng JavaScript -->
      </div>

      <!-- M·∫´u hi·ªÉn th·ªã ƒë∆°n h√†ng (s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript) -->
      <div class="order-template" style="display: none">
        <div class="order-card">
          <div class="order-header">
            <h3>M√£ ƒë∆°n h√†ng: <span class="order-id">#103663997</span></h3>
            <span class="status-btn">ƒêang x√°c nh·∫≠n</span>
          </div>

          <div class="order-status-box">
            <span class="status-item active">ƒêang x√°c nh·∫≠n</span>
            <i class="fas fa-ellipsis-h status-divider"></i>
            <span class="status-item">ƒêang x·ª≠ l√Ω</span>
            <i class="fas fa-ellipsis-h status-divider"></i>
            <span class="status-item">ƒêang giao h√†ng</span>
            <i class="fas fa-ellipsis-h status-divider"></i>
            <span class="status-item">Ho√†n t·∫•t</span>
          </div>

          <div class="shipping-info">
            <p><strong>Th√¥ng tin v·∫≠n chuy·ªÉn</strong></p>
            <p class="info-detail">Nh√† S√°ch ABC ƒëang x√°c nh·∫≠n ƒë∆°n h√†ng</p>
            <p class="date-time">22/04/2025 - 16:18</p>
          </div>

          <div class="delivery-estimate">
            Ng√†y d·ª± ki·∫øn giao h√†ng: <strong>23/04/2025</strong>
          </div>

          <div class="order-items">
            <h4>Chi ti·∫øt ƒë∆°n h√†ng:</h4>
            <table class="order-items-table">
              <thead>
                <tr>
                  <th>S·∫£n ph·∫©m</th>
                  <th>Gi√°</th>
                  <th>S·ªë l∆∞·ª£ng</th>
                  <th>T·∫°m t√≠nh</th>
                </tr>
              </thead>
              <tbody>
                <!-- S·∫£n ph·∫©m s·∫Ω ƒë∆∞·ª£c th√™m b·∫±ng JavaScript -->
              </tbody>
            </table>
          </div>

          <div class="order-summary">
            <div class="summary-row">
              <span>T·∫°m t√≠nh:</span>
              <span class="subtotal">150.000ƒë</span>
            </div>
            <div class="summary-row">
              <span>Ph√≠ v·∫≠n chuy·ªÉn:</span>
              <span class="shipping-fee">20.000ƒë</span>
            </div>
            <div class="summary-row total">
              <span>T·ªïng c·ªông:</span>
              <span class="order-total">170.000ƒë</span>
            </div>
          </div>

          <div class="customer-info">
            <h4>Th√¥ng tin kh√°ch h√†ng:</h4>
            <div class="info-grid">
              <div>
                <p>
                  <strong>H·ªç t√™n:</strong>
                  <span class="customer-name">Nguy·ªÖn VƒÉn A</span>
                </p>
                <p>
                  <strong>ƒêi·ªán tho·∫°i:</strong>
                  <span class="customer-phone">0987654321</span>
                </p>
              </div>
              <div>
                <p>
                  <strong>Email:</strong>
                  <span class="customer-email">example@email.com</span>
                </p>
                <p>
                  <strong>ƒê·ªãa ch·ªâ:</strong>
                  <span class="customer-address"
                    >189 Cao L·ªó, P4, Q8, TP HCM</span
                  >
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Hi·ªÉn th·ªã khi kh√¥ng c√≥ ƒë∆°n h√†ng -->
      <div class="empty-order" id="empty-order">
        <i class="fas fa-shopping-bag"></i>
        <p>B·∫°n ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</p>
        <a href="index.html" class="continue-shopping-btn">Ti·∫øp t·ª•c mua s·∫Øm</a>
      </div>
    </div>

    <!-- FOOTER (Gi·ªëng c√°c trang kh√°c) -->
    <footer class="footer" id="footer">
      <div class="footer-container">
        <!-- N·ªôi dung footer gi·ªëng nh∆∞ c√°c trang kh√°c -->
      </div>
    </footer>

    <script src="script.js"></script>
    <script>
      // H√†m hi·ªÉn th·ªã t·∫•t c·∫£ ƒë∆°n h√†ng
      function displayAllOrders() {
        const ordersList = document.getElementById("orders-list");
        const emptyOrder = document.getElementById("empty-order");
        const orderTemplate = document.querySelector(".order-template");

        // L·∫•y ƒë∆°n h√†ng t·ª´ localStorage
        const orders = JSON.parse(localStorage.getItem("orders")) || [];

        // X√≥a n·ªôi dung c≈©
        ordersList.innerHTML = "";

        if (orders.length === 0) {
          emptyOrder.style.display = "block";
          return;
        }

        emptyOrder.style.display = "none";

        // Hi·ªÉn th·ªã c√°c ƒë∆°n h√†ng theo th·ª© t·ª± m·ªõi nh·∫•t l√™n ƒë·∫ßu
        orders.reverse().forEach((order) => {
          const orderId = `ABC-${new Date(order.date)
            .getTime()
            .toString()
            .slice(-6)}`;
          const orderDate = new Date(order.date).toLocaleString("vi-VN");

          // T·∫°o b·∫£n sao c·ªßa template
          const orderClone = orderTemplate.cloneNode(true);
          orderClone.style.display = "block";

          // C·∫≠p nh·∫≠t th√¥ng tin chung
          orderClone.querySelector(".order-id").textContent = orderId;

          // C·∫≠p nh·∫≠t tr·∫°ng th√°i
          const statusBtn = orderClone.querySelector(".status-btn");
          statusBtn.textContent = getStatusText(order.status || "pending");
          statusBtn.className =
            "status-btn " + getStatusClass(order.status || "pending");

          // C·∫≠p nh·∫≠t timeline tr·∫°ng th√°i
          updateStatusTimeline(orderClone, order.status || "pending");

          // C·∫≠p nh·∫≠t th√¥ng tin v·∫≠n chuy·ªÉn
          orderClone.querySelector(
            ".info-detail"
          ).textContent = `Nh√† S√°ch ABC ${getStatusDetail(
            order.status || "pending"
          )}`;
          orderClone.querySelector(".date-time").textContent = orderDate;

          // C·∫≠p nh·∫≠t ng√†y d·ª± ki·∫øn giao h√†ng (th√™m 1 ng√†y t·ª´ ng√†y ƒë·∫∑t)
          const deliveryDate = new Date(order.date);
          deliveryDate.setDate(deliveryDate.getDate() + 1);
          orderClone.querySelector(".delivery-estimate strong").textContent =
            deliveryDate.toLocaleDateString("vi-VN");

          // C·∫≠p nh·∫≠t s·∫£n ph·∫©m
          const tbody = orderClone.querySelector(".order-items-table tbody");
          tbody.innerHTML = "";

          let subtotal = 0;
          order.items.forEach((item) => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;

            const tr = document.createElement("tr");
            tr.innerHTML = `
              <td>${item.name}</td>
              <td>${item.price.toLocaleString("vi-VN")}ƒë</td>
              <td>${item.quantity}</td>
              <td>${itemTotal.toLocaleString("vi-VN")}ƒë</td>
            `;
            tbody.appendChild(tr);
          });

          // C·∫≠p nh·∫≠t t·ªïng ti·ªÅn
          const shippingFee = 20000;
          orderClone.querySelector(
            ".subtotal"
          ).textContent = `${subtotal.toLocaleString("vi-VN")}ƒë`;
          orderClone.querySelector(
            ".shipping-fee"
          ).textContent = `${shippingFee.toLocaleString("vi-VN")}ƒë`;
          orderClone.querySelector(".order-total").textContent = `${(
            subtotal + shippingFee
          ).toLocaleString("vi-VN")}ƒë`;

          // C·∫≠p nh·∫≠t th√¥ng tin kh√°ch h√†ng
          orderClone.querySelector(".customer-name").textContent =
            order.customer.fullname;
          orderClone.querySelector(".customer-phone").textContent =
            order.customer.phone;
          orderClone.querySelector(".customer-email").textContent =
            order.customer.email;
          orderClone.querySelector(".customer-address").textContent =
            order.customer.address;

          // Th√™m ƒë∆°n h√†ng v√†o danh s√°ch
          ordersList.appendChild(orderClone);
        });
      }

      function getStatusText(status) {
        switch (status) {
          case "pending":
            return "ƒêang x√°c nh·∫≠n";
          case "processing":
            return "ƒêang x·ª≠ l√Ω";
          case "shipping":
            return "ƒêang giao h√†ng";
          case "completed":
            return "Ho√†n t·∫•t";
          case "cancelled":
            return "ƒê√£ h·ªßy";
          default:
            return "ƒêang x√°c nh·∫≠n";
        }
      }

      function getStatusClass(status) {
        switch (status) {
          case "pending":
            return "status-pending";
          case "processing":
            return "status-processing";
          case "shipping":
            return "status-shipping";
          case "completed":
            return "status-completed";
          case "cancelled":
            return "status-cancelled";
          default:
            return "status-pending";
        }
      }

      function getStatusDetail(status) {
        switch (status) {
          case "pending":
            return "ƒëang x√°c nh·∫≠n ƒë∆°n h√†ng";
          case "processing":
            return "ƒëang x·ª≠ l√Ω ƒë∆°n h√†ng";
          case "shipping":
            return "ƒëang giao h√†ng";
          case "completed":
            return "ƒë√£ ho√†n t·∫•t ƒë∆°n h√†ng";
          case "cancelled":
            return "ƒë√£ h·ªßy ƒë∆°n h√†ng";
          default:
            return "ƒëang x√°c nh·∫≠n ƒë∆°n h√†ng";
        }
      }

      function updateStatusTimeline(orderElement, status) {
        const statusItems = orderElement.querySelectorAll(".status-item");
        statusItems.forEach((item) => item.classList.remove("active"));

        switch (status) {
          case "pending":
            statusItems[0].classList.add("active");
            break;
          case "processing":
            statusItems[0].classList.add("active");
            statusItems[1].classList.add("active");
            break;
          case "shipping":
            statusItems[0].classList.add("active");
            statusItems[1].classList.add("active");
            statusItems[2].classList.add("active");
            break;
          case "completed":
            statusItems.forEach((item) => item.classList.add("active"));
            break;
          case "cancelled":
            // Kh√¥ng active b·∫•t k·ª≥ b∆∞·ªõc n√†o
            break;
          default:
            statusItems[0].classList.add("active");
        }
      }

      // T·∫£i ƒë∆°n h√†ng khi trang ƒë∆∞·ª£c m·ªü
      document.addEventListener("DOMContentLoaded", displayAllOrders);
    </script>
  </body>
</html>
